[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2017-10-03 11:47:28.438305", 
  "name": "Sales Invoice-Client", 
  "script": "frappe.ui.form.on(\"Sales Invoice\", {\r\n\trefresh: function() {\r\n\t\tcur_frm.add_custom_button(__(\"Inquiry\"), function() {\r\n\t\t\terpnext.utils.map_current_doc({\r\n\t\t\t\tmethod: \"erpnext.selling.doctype.sales_order.sales_order.make_delivery_note\",\r\n\t\t\t\tsource_doctype: \"Inquiry\",\r\n\t\t\t\ttarget: cur_frm,\r\n\t\t\t\tsetters: {\r\n\t\t\t\t\tcustomer: cur_frm.doc.customer || undefined,\r\n\t\t\t\t},\r\n\t\t\t\tget_query_filters: {\r\n\t\t\t\t\tdocstatus: 1,\r\n\t\t\t\t\tcompany: cur_frm.doc.company,\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}, __(\"Get items from\"));\r\n\t},\r\n\trefresh: function(frm){\r\n\t\tfrm.events.set_total_delivery_note(frm);\r\n\t\tfrm.events.set_total_related_invoice(frm);\r\n\t},\r\n\tvalidate: function(frm){\r\n\t\tfrm.events.set_total_delivery_note(frm);\r\n\t\tfrm.events.set_total_related_invoice(frm);\r\n\t},\r\n\ttype_of_invoice: function(frm){\r\n\t\tif(frm.doc.type_of_invoice == \"Pelunasan\"){\r\n\t\t\tfrm.clear_table(\"delivery\");\r\n\t\t\tif(!frm.doc.inquiry) return;\r\n\t\t\treturn frappe.call({\r\n\t\t\t\tmethod: 'preorder.preorder.lemparan.get_delivery_note',\r\n\t\t\t\targs: {\r\n\t\t\t\t\tinquiry: frm.doc.inquiry\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(r, rt) {\r\n\t\t\t\t\tif(r.message) {\r\n\t\t\t\t\t\t$.each(r.message, function(i, d) {\r\n\t\t\t\t\t\t\tvar c = frm.add_child(\"delivery\");\r\n\t\t\t\t\t\t\tc.delivery_note = d.delivery_note;\r\n\t\t\t\t\t\t\tc.posting_date = d.posting_date;\r\n\t\t\t\t\t\t\tc.net_total = d.net_total;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tfrm.refresh_fields();\r\n\t\t\t\t\t\tfrm.events.set_total_delivery_note(frm);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}else if(frm.doc.type_of_invoice == \"Retensi\"){\r\n\t\t\tfrm.clear_table(\"related\");\r\n\t\t\tif(!frm.doc.inquiry) return;\r\n\t\t\treturn frappe.call({\r\n\t\t\t\tmethod: 'preorder.preorder.lemparan.get_sales_invoice',\r\n\t\t\t\targs: {\r\n\t\t\t\t\tinquiry: frm.doc.inquiry\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(r, rt) {\r\n\t\t\t\t\tif(r.message) {\r\n\t\t\t\t\t\t$.each(r.message, function(i, d) {\r\n\t\t\t\t\t\t\tvar c = frm.add_child(\"related\");\r\n\t\t\t\t\t\t\tc.sales_invoice = d.sales_invoice;\r\n\t\t\t\t\t\t\tc.posting_date = d.posting_date;\r\n\t\t\t\t\t\t\tc.net_total = d.net_total;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tfrm.refresh_fields();\r\n\t\t\t\t\t\tfrm.events.set_total_related_invoice(frm);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\tpercentage_dp: function(frm){\r\n\t\tfrm.events.set_total_delivery_note(frm);\r\n\t},\r\n\tset_total_delivery_note: function(frm) {\r\n\t\tvar total_dn = 0.0;\r\n\t\t$.each(frm.doc.delivery, function(i, row) {\r\n\t\t\ttotal_dn += flt(row.net_total);\r\n\t\t})\r\n\t\tfrm.set_value(\"total_delivery_note\", Math.abs(total_dn));\r\n\t},\r\n\tset_total_related_invoice: function(frm) {\r\n\t\tvar total_si = 0.0;\r\n\t\t$.each(frm.doc.related, function(i, row) {\r\n\t\t\ttotal_si += flt(row.net_total);\r\n\t\t})\r\n\t\tfrm.set_value(\"total_related_invoices\", Math.abs(total_si));\r\n\t\tfrm.set_value(\"write_off_amount\", Math.abs(total_si));\r\n\t},\r\n\tadjust_taxes_and_charges: function(frm, cdt, cdn) {\r\n\t\tvar tbl = frm.doc.taxes || [];\r\n\t\tvar i = tbl.length;\r\n\t\twhile (i--) {\r\n\t\t\tif(frm.doc.taxes[i].charge_type != \"Actual\"){\r\n\t\t\t\tvar selisih = flt(frm.doc.net_total) - flt(frm.doc.write_off_amount);\r\n\t\t\t\tvar actual = (flt(frm.doc.taxes[i].tax_amount)/flt(frm.doc.net_total)) * selisih;\r\n\t\t\t\tfrm.doc.taxes[i].tax_amount = Math.abs(actual);\r\n\t\t\t\tfrm.doc.taxes[i].charge_type = \"Actual\";\r\n\t\t\t\tfrm.refresh_field(\"taxes\");\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n});\r\nfrappe.ui.form.on(\"Sales Invoice\", \"get_items\", function(frm) {\r\n    if(frm.doc.type_of_invoice == \"Down Payment\"){\r\n\terpnext.utils.map_current_doc({\r\n\t    method: \"preorder.preorder.lemparan.get_items_tampungan\",\r\n\t    source_name: \"SO|\"+cur_frm.doc.sales_order+\"|\"+cur_frm.doc.percentage_dp+\"|\"+cur_frm.doc.inquiry,\r\n\t});\r\n    }else if(frm.doc.type_of_invoice == \"Progress Payment\"){\r\n\terpnext.utils.map_current_doc({\r\n\t    method: \"preorder.preorder.lemparan.get_items_tampungan\",\r\n\t    source_name: \"DN|\"+cur_frm.doc.delivery_note+\"|\"+cur_frm.doc.percentage_dp+\"|\"+cur_frm.doc.inquiry,\r\n\t});\r\n    }else if(frm.doc.type_of_invoice == \"Pelunasan\"){\r\n\terpnext.utils.map_current_doc({\r\n\t    method: \"preorder.preorder.lemparan.get_items_from_pelunasan\",\r\n\t    source_name: frm.doc.total_delivery_note+\"|\"+cur_frm.doc.percentage_dp+\"|\"+cur_frm.doc.inquiry,\r\n\t});\r\n    }\r\n})\r\n/*\r\nvar calculate_total_dn = function(frm) {\r\n    var total_claim = frappe.utils.sum(\r\n        (frm.doc.delivery || []).map(function(i) {\r\n\t\t\treturn (i.net_total);\r\n\t\t})\r\n    );\r\n    frm.set_value(\"total_delivery_note\", total_claim);\r\n}\r\nfrappe.ui.form.on(\"Sales Invoice\", \"percentage_dp\", function(frm) {\r\n    calculate_total_dn(frm);\r\n})\r\nfrappe.ui.form.on(\"Sales Invoice\", \"validate\", function(frm) {\r\n    calculate_total_dn(frm);\r\n})\r\n*/\r\ncur_frm.set_query(\"sales_order\",  function (frm) {\r\n    return {\r\n        filters: [\r\n            ['docstatus', '=', '1'],\r\n\t    ['status', 'in', 'To Deliver and Bill, To Bill, To Deliver, Completed'],\r\n\t    ['customer', '=', cur_frm.doc.customer]\r\n        ]\r\n    }\r\n});\r\nfrappe.ui.form.on(\"Sales Invoice\", \"sales_order\", function(frm, cdt, cdn) {\r\n\tfrappe.call({\r\n\t\tmethod: \"frappe.client.get\",\r\n\t        args: {\r\n\t\t\tdoctype: \"Sales Order\",\r\n\t\t\tfilters:{\r\n\t\t\t\tname: cur_frm.doc.sales_order\r\n\t\t\t}\r\n\t        },\r\n\t        callback: function (data) {\r\n\t\t\tfrappe.model.set_value(cdt, cdn, \"nominal_so\", data.message.net_total);\r\n\t\t}\r\n\t})\r\n});\r\nfrappe.ui.form.on(\"Sales Invoice\", \"validate\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nvar calculate_multilevel_discount = function(frm) {\r\n    var diskon1 = frm.doc.discount_1;\r\n    var diskon2 = frm.doc.discount_2;\r\n    var diskon3 = frm.doc.discount_3;\r\n    var diskon1_amt = ((100 - diskon1)/100) * 100;\r\n    var diskon2_amt = ((100 - diskon2)/100) * diskon1_amt;\r\n    var diskon3_amt = ((100 - diskon3)/100) * diskon2_amt;\r\n    var total_diskon = 100 - diskon3_amt;\r\n    var diskon1_amount = (diskon1/100) * frm.doc.total;\r\n    var amount_after1 = frm.doc.total - diskon1_amount;\r\n    var diskon2_amount = (diskon2/100) * amount_after1;\r\n    var amount_after2 = amount_after1 - diskon2_amount;\r\n    var diskon3_amount = (diskon3/100) * amount_after2;\r\n    var amount_after3 = amount_after2 - diskon3_amount;\r\n    frm.set_value(\"additional_discount_percentage\", total_diskon);\r\n    frm.set_value(\"discount_1_amount\", diskon1_amount);\r\n    frm.set_value(\"amount_after_discount_1\", amount_after1);\r\n    frm.set_value(\"discount_2_amount\", diskon2_amount);\r\n    frm.set_value(\"amount_after_discount_2\", amount_after2);\r\n    frm.set_value(\"discount_3_amount\", diskon3_amount);\r\n    frm.set_value(\"amount_after_discount_3\", amount_after3);\r\n}\r\nfrappe.ui.form.on(\"Sales Invoice\", \"discount_1\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Sales Invoice\", \"discount_2\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Sales Invoice\", \"discount_3\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Sales Invoice\", \"net_total\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Supplier Quotation", 
  "modified": "2017-08-14 16:11:48.420412", 
  "name": "Supplier Quotation-Client", 
  "script": "frappe.ui.form.on(\"Supplier Quotation\", \"refresh\", function() {\n  if(cur_frm.doc.docstatus == 0 || cur_frm.doc.__islocal){\n    cur_frm.add_custom_button(__('Request for Supplier Quotation'), function() {\n      erpnext.utils.map_current_doc({\n        method: \"preorder.preorder.doctype.request_for_supplier_quotation.request_for_supplier_quotation.make_supplier_quotation\",\n        source_doctype: \"Request for Supplier Quotation\",\n        target: cur_frm,\n        setters:  {\n\t  supplier: cur_frm.doc.supplier|| undefined,\n        },\n        get_query_filters: {\n      \t  docstatus: [\"!=\", 2]\n      }\n    })}, __(\"Get items from\"));\n    cur_frm.clear_custom_button()\n  };\n  if (cur_frm.doc.docstatus === 1){\n    cur_frm.clear_custom_button()\n  }\n})", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Order", 
  "modified": "2017-10-03 11:47:28.560584", 
  "name": "Purchase Order-Client", 
  "script": "frappe.ui.form.on(\"Purchase Order\", \"validate\", function(frm) {\r\n\t$.each(frm.doc.items, function(i, d) {\r\n\t\tif(d.amount == '0'){\r\n\t\t\tmsgprint(\"Item No.\"+d.idx+\", amount still empty\");\r\n\t\t\tvalidated = false;\r\n\t\t}\r\n\t})\r\n})\r\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Order", 
  "modified": "2017-10-03 11:47:28.593989", 
  "name": "Sales Order-Client", 
  "script": "/*\r\nfrappe.ui.form.on(\"Sales Order\", \"refresh\", function(frm) {\r\n    if(frm.doc.docstatus==1){\r\n\tcur_frm.add_custom_button(__('Purchase Order'), cur_frm.cscript['Purchase Order'], __(\"Make\"));\r\n\tcur_frm.page.set_inner_btn_group_as_primary(__(\"Make\"));\r\n    }\r\n});\r\ncur_frm.cscript['Purchase Order'] = function() {\r\n\tfrappe.model.open_mapped_doc({\r\n\t\tmethod: \"preorder.preorder.lemparan.make_purchase_order\",\r\n\t\tfrm: cur_frm\r\n\t})\r\n}*/\r\nfrappe.ui.form.on(\"Sales Order\", \"refresh\", function(frm, cdt, cdn) {\r\n    var tbl = frm.doc.items || [];\r\n    var i = tbl.length;\r\n    while (i--) {\r\n\tif(frm.doc.items[i].quotation_rate == 0){\r\n            frm.doc.items[i].quotation_rate = frm.doc.items[i].rate;\r\n            frm.refresh_field(\"items\");\r\n\t}\r\n    }\r\n})\r\nfrappe.ui.form.on(\"Sales Order\", \"reset_rate\", function(frm, cdt, cdn) {\r\n    var tbl = frm.doc.items || [];\r\n    var i = tbl.length;\r\n    while (i--) {\r\n            frm.doc.items[i].rate = frm.doc.items[i].quotation_rate;\r\n            frm.refresh_field(\"items\");\r\n    }\r\n})\r\nvar calculate_multilevel_discount = function(frm) {\r\n    var diskon1 = frm.doc.discount_1;\r\n    var diskon2 = frm.doc.discount_2;\r\n    var diskon3 = frm.doc.discount_3;\r\n    var diskon1_amt = ((100 - diskon1)/100) * 100;\r\n    var diskon2_amt = ((100 - diskon2)/100) * diskon1_amt;\r\n    var diskon3_amt = ((100 - diskon3)/100) * diskon2_amt;\r\n    var total_diskon = 100 - diskon3_amt;\r\n    var diskon1_amount = (diskon1/100) * frm.doc.total;\r\n    var amount_after1 = frm.doc.total - diskon1_amount;\r\n    var diskon2_amount = (diskon2/100) * amount_after1;\r\n    var amount_after2 = amount_after1 - diskon2_amount;\r\n    var diskon3_amount = (diskon3/100) * amount_after2;\r\n    var amount_after3 = amount_after2 - diskon3_amount;\r\n    frm.set_value(\"discount_1_amount\", diskon1_amount);\r\n    frm.set_value(\"amount_after_discount_1\", amount_after1);\r\n    frm.set_value(\"discount_2_amount\", diskon2_amount);\r\n    frm.set_value(\"amount_after_discount_2\", amount_after2);\r\n    frm.set_value(\"discount_3_amount\", diskon3_amount);\r\n    frm.set_value(\"amount_after_discount_3\", amount_after3);\r\n    frm.set_value(\"additional_discount_percentage\", total_diskon);\r\n    frm.set_value(\"total_discount_percentage\", total_diskon);\r\n    var aa = (total_diskon/100) * frm.doc.total;\r\n    frm.set_value(\"total_discount_amount\", aa);\r\n}\r\nfrappe.ui.form.on(\"Sales Order\", \"discount_1\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Sales Order\", \"discount_2\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Sales Order\", \"discount_3\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Sales Order\", \"net_total\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Sales Order\", \"validate\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n    beda_diskon_amount(frm);\r\n})\r\nvar beda_diskon_amount = function(frm){\r\n    var total_diskon_persen = frm.doc.total_discount_percentage;\r\n    var total_diskon_amount = (total_diskon_persen/100) * frm.doc.total;\r\n    if(total_diskon_amount != frm.doc.total_discount_amount){\r\n\tfrm.set_value(\"total_discount_percentage\", \"0\");\r\n\tfrm.set_value(\"discount_amount\", frm.doc.total_discount_amount);\r\n    }\r\n}\r\nfrappe.ui.form.on(\"Sales Order\", \"total_discount_amount\", function(frm) {\r\n    beda_diskon_amount(frm);\r\n})\r\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Delivery Note", 
  "modified": "2017-10-03 11:47:28.577651", 
  "name": "Delivery Note-Client", 
  "script": "var calculate_multilevel_discount = function(frm) {\r\n    var diskon1 = frm.doc.discount_1;\r\n    var diskon2 = frm.doc.discount_2;\r\n    var diskon3 = frm.doc.discount_3;\r\n    var diskon1_amt = ((100 - diskon1)/100) * 100;\r\n    var diskon2_amt = ((100 - diskon2)/100) * diskon1_amt;\r\n    var diskon3_amt = ((100 - diskon3)/100) * diskon2_amt;\r\n    var total_diskon = 100 - diskon3_amt;\r\n    var diskon1_amount = (diskon1/100) * frm.doc.total;\r\n    var amount_after1 = frm.doc.total - diskon1_amount;\r\n    var diskon2_amount = (diskon2/100) * amount_after1;\r\n    var amount_after2 = amount_after1 - diskon2_amount;\r\n    var diskon3_amount = (diskon3/100) * amount_after2;\r\n    var amount_after3 = amount_after2 - diskon3_amount;\r\n    frm.set_value(\"discount_1_amount\", diskon1_amount);\r\n    frm.set_value(\"amount_after_discount_1\", amount_after1);\r\n    frm.set_value(\"discount_2_amount\", diskon2_amount);\r\n    frm.set_value(\"amount_after_discount_2\", amount_after2);\r\n    frm.set_value(\"discount_3_amount\", diskon3_amount);\r\n    frm.set_value(\"amount_after_discount_3\", amount_after3);\r\n    frm.set_value(\"additional_discount_percentage\", total_diskon);\r\n    frm.set_value(\"total_discount_percentage\", total_diskon);\r\n    var aa = (total_diskon/100) * frm.doc.total;\r\n    frm.set_value(\"total_discount_amount\", aa);\r\n}\r\nfrappe.ui.form.on(\"Delivery Note\", \"discount_1\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Delivery Note\", \"discount_2\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Delivery Note\", \"discount_3\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Delivery Note\", \"net_total\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Delivery Note\", \"validate\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n    beda_diskon_amount(frm);\r\n})\r\nvar beda_diskon_amount = function(frm){\r\n    var total_diskon_persen = frm.doc.total_discount_percentage;\r\n    var total_diskon_amount = (total_diskon_persen/100) * frm.doc.total;\r\n    if(total_diskon_amount != frm.doc.total_discount_amount){\r\n\tfrm.set_value(\"total_discount_percentage\", \"0\");\r\n\tfrm.set_value(\"discount_amount\", frm.doc.total_discount_amount);\r\n    }\r\n}\r\nfrappe.ui.form.on(\"Delivery Note\", \"total_discount_amount\", function(frm) {\r\n    beda_diskon_amount(frm);\r\n})\r\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Quotation", 
  "modified": "2017-10-03 11:47:28.569269", 
  "name": "Quotation-Client", 
  "script": "frappe.ui.form.on(\"Quotation\", \"get_items\", function(frm) {\r\n\terpnext.utils.map_current_doc({\r\n\t\tmethod: \"preorder.preorder.lemparan.get_items_selling_quotation\",\r\n\t\tsource_name: cur_frm.doc.inquiry,\r\n\t});\r\n})\r\ncur_frm.set_query(\"inquiry\", function(frm) {\r\n    return {\r\n        filters: {\r\n\t    'customer': cur_frm.doc.customer || undefined,\r\n\t    'docstatus': 1,\r\n\t    'quotation': '',\r\n\t    'status': [\"!=\", \"Lost\"]\r\n\t},\r\n    }\r\n});\r\n/*\r\ncur_frm.cscript.gunakan_1 = function(doc, cdt, cdn) {\r\n\tvar d = locals[cdt][cdn];\r\n\t    if(d.supplier_1){\r\n\t\tvar centang = 0;\r\n\t\tif(d.gunakan_1 == \"1\"){\r\n\t\t\tcentang +=1;\r\n\t\t}\r\n\t\tif(d.gunakan_2 == \"1\"){\r\n\t\t\tcentang +=1;\r\n\t\t}\r\n\t\tif(d.gunakan_3 == \"1\"){\r\n\t\t\tcentang +=1;\r\n\t\t}\r\n\t\td.jmlh_centang = centang;\r\n\t\trefresh_field('jmlh_centang', d.name, 'items');\r\n\t    }\r\n}\r\ncur_frm.cscript.gunakan_3 = cur_frm.cscript.gunakan_2 = cur_frm.cscript.gunakan_1\r\nfrappe.ui.form.on(\"Quotation\", \"validate\", function(frm) {\r\n\t$.each(frm.doc.items, function(i, d) {\r\n\t    if(d.supplier_1 != undefined){\r\n\t\tif(d.jmlh_centang == '0'){\r\n\t\t\tmsgprint(\"Item No.\"+d.idx+\", Supplier not selected\");\r\n\t\t\tvalidated = false;\r\n\t\t}\r\n\t\tif(d.jmlh_centang >= '2'){\r\n\t\t\tmsgprint(\"Item No.\"+d.idx+\", Supplier selected more than one\");\r\n\t\t\tvalidated = false;\r\n\t\t}\r\n\t    }\r\n\t})\r\n})\r\n*/\r\nvar calculate_multilevel_discount = function(frm) {\r\n    var diskon1 = frm.doc.discount_1;\r\n    var diskon2 = frm.doc.discount_2;\r\n    var diskon3 = frm.doc.discount_3;\r\n    var diskon1_amt = ((100 - diskon1)/100) * 100;\r\n    var diskon2_amt = ((100 - diskon2)/100) * diskon1_amt;\r\n    var diskon3_amt = ((100 - diskon3)/100) * diskon2_amt;\r\n    var total_diskon = 100 - diskon3_amt;\r\n    var diskon1_amount = (diskon1/100) * frm.doc.total;\r\n    var amount_after1 = frm.doc.total - diskon1_amount;\r\n    var diskon2_amount = (diskon2/100) * amount_after1;\r\n    var amount_after2 = amount_after1 - diskon2_amount;\r\n    var diskon3_amount = (diskon3/100) * amount_after2;\r\n    var amount_after3 = amount_after2 - diskon3_amount;\r\n    frm.set_value(\"discount_1_amount\", diskon1_amount);\r\n    frm.set_value(\"amount_after_discount_1\", amount_after1);\r\n    frm.set_value(\"discount_2_amount\", diskon2_amount);\r\n    frm.set_value(\"amount_after_discount_2\", amount_after2);\r\n    frm.set_value(\"discount_3_amount\", diskon3_amount);\r\n    frm.set_value(\"amount_after_discount_3\", amount_after3);\r\n    frm.set_value(\"additional_discount_percentage\", total_diskon);\r\n    frm.set_value(\"total_discount_percentage\", total_diskon);\r\n    var aa = (total_diskon/100) * frm.doc.total;\r\n    frm.set_value(\"total_discount_amount\", aa);\r\n}\r\nfrappe.ui.form.on(\"Quotation\", \"discount_1\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Quotation\", \"discount_2\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Quotation\", \"discount_3\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Quotation\", \"net_total\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n})\r\nfrappe.ui.form.on(\"Quotation\", \"validate\", function(frm) {\r\n    calculate_multilevel_discount(frm);\r\n    beda_diskon_amount(frm);\r\n})\r\nvar beda_diskon_amount = function(frm){\r\n    var total_diskon_persen = frm.doc.total_discount_percentage;\r\n    var total_diskon_amount = (total_diskon_persen/100) * frm.doc.total;\r\n    if(total_diskon_amount != frm.doc.total_discount_amount){\r\n\tfrm.set_value(\"total_discount_percentage\", \"0\");\r\n\tfrm.set_value(\"discount_amount\", frm.doc.total_discount_amount);\r\n    }\r\n}\r\nfrappe.ui.form.on(\"Quotation\", \"total_discount_amount\", function(frm) {\r\n    beda_diskon_amount(frm);\r\n})\r\nfrappe.ui.form.on(\"Quotation\", \"validate\", function(frm) {\r\n\t$.each(frm.doc.items, function(i, d) {\r\n\t    if(d.rate == 0 && d.alternative_item == 1){\r\n\t\tmsgprint(\"Item No.\"+d.idx+\", rate is still zero\");\r\n\t\tvalidated = false;\r\n\t    }\r\n\t})\r\n})\r\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Invoice", 
  "modified": "2017-10-03 11:47:28.585536", 
  "name": "Purchase Invoice-Client", 
  "script": "frappe.ui.form.on(\"Purchase Invoice\", {\r\n\trefresh: function() {\r\n\r\n\t},\r\n\trefresh: function(frm){\r\n\t\tfrm.events.set_total_purchase_receipt(frm);\r\n\t\tfrm.events.set_total_related_invoice(frm);\r\n\t},\r\n\tvalidate: function(frm){\r\n\t\tfrm.events.set_total_purchase_receipt(frm);\r\n\t\tfrm.events.set_total_related_invoice(frm);\r\n\t},\r\n\ttype_of_invoice: function(frm){\r\n\t\tif(frm.doc.type_of_invoice == \"Pelunasan\"){\r\n\t\t\tfrm.clear_table(\"receipt\");\r\n//\t\t\tif(!frm.doc.inquiry) return;\r\n\t\t\treturn frappe.call({\r\n\t\t\t\tmethod: 'preorder.preorder.lemparan.get_delivery_note',\r\n\t\t\t\targs: {\r\n\t\t\t\t\tinquiry: frm.doc.inquiry\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(r, rt) {\r\n\t\t\t\t\tif(r.message) {\r\n\t\t\t\t\t\t$.each(r.message, function(i, d) {\r\n\t\t\t\t\t\t\tvar c = frm.add_child(\"receipt\");\r\n\t\t\t\t\t\t\tc.delivery_note = d.delivery_note;\r\n\t\t\t\t\t\t\tc.posting_date = d.posting_date;\r\n\t\t\t\t\t\t\tc.net_total = d.net_total;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tfrm.refresh_fields();\r\n\t\t\t\t\t\tfrm.events.set_total_delivery_note(frm);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}else if(frm.doc.type_of_invoice == \"Retensi\"){\r\n\t\t\tfrm.clear_table(\"related\");\r\n//\t\t\tif(!frm.doc.inquiry) return;\r\n\t\t\treturn frappe.call({\r\n\t\t\t\tmethod: 'preorder.preorder.lemparan.get_sales_invoice',\r\n\t\t\t\targs: {\r\n\t\t\t\t\tinquiry: frm.doc.inquiry\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(r, rt) {\r\n\t\t\t\t\tif(r.message) {\r\n\t\t\t\t\t\t$.each(r.message, function(i, d) {\r\n\t\t\t\t\t\t\tvar c = frm.add_child(\"related\");\r\n\t\t\t\t\t\t\tc.sales_invoice = d.sales_invoice;\r\n\t\t\t\t\t\t\tc.posting_date = d.posting_date;\r\n\t\t\t\t\t\t\tc.net_total = d.net_total;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tfrm.refresh_fields();\r\n\t\t\t\t\t\tfrm.events.set_total_related_invoice(frm);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\tpercentage_dp: function(frm){\r\n\t\tfrm.events.set_total_delivery_note(frm);\r\n\t},\r\n\tset_total_purchase_receipt: function(frm) {\r\n\t\tvar total_dn = 0.0;\r\n\t\t$.each(frm.doc.receipt, function(i, row) {\r\n\t\t\ttotal_dn += flt(row.net_total);\r\n\t\t})\r\n\t\tfrm.set_value(\"total_purchase_receipt\", Math.abs(total_dn));\r\n\t},\r\n\tset_total_related_invoice: function(frm) {\r\n\t\tvar total_si = 0.0;\r\n\t\t$.each(frm.doc.related, function(i, row) {\r\n\t\t\ttotal_si += flt(row.net_total);\r\n\t\t})\r\n\t\tfrm.set_value(\"total_related_invoices\", Math.abs(total_si));\r\n\t\tfrm.set_value(\"write_off_amount\", Math.abs(total_si));\r\n\t},\r\n\tadjust_taxes_and_charges: function(frm, cdt, cdn) {\r\n\t\tvar tbl = frm.doc.taxes || [];\r\n\t\tvar i = tbl.length;\r\n\t\twhile (i--) {\r\n\t\t\tif(frm.doc.taxes[i].charge_type != \"Actual\"){\r\n\t\t\t\tvar selisih = flt(frm.doc.net_total) - flt(frm.doc.write_off_amount);\r\n\t\t\t\tvar actual = (flt(frm.doc.taxes[i].tax_amount)/flt(frm.doc.net_total)) * selisih;\r\n\t\t\t\tfrm.doc.taxes[i].tax_amount = Math.abs(actual);\r\n\t\t\t\tfrm.doc.taxes[i].charge_type = \"Actual\";\r\n\t\t\t\tfrm.refresh_field(\"taxes\");\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n});\r\nfrappe.ui.form.on(\"Sales Invoice\", \"get_items\", function(frm) {\r\n    if(frm.doc.type_of_invoice == \"Down Payment\"){\r\n\terpnext.utils.map_current_doc({\r\n\t    method: \"preorder.preorder.lemparan.get_items_tampungan\",\r\n\t    source_name: \"SO|\"+cur_frm.doc.sales_order+\"|\"+cur_frm.doc.percentage_dp+\"|\"+cur_frm.doc.inquiry,\r\n\t});\r\n    }else if(frm.doc.type_of_invoice == \"Progress Payment\"){\r\n\terpnext.utils.map_current_doc({\r\n\t    method: \"preorder.preorder.lemparan.get_items_tampungan\",\r\n\t    source_name: \"DN|\"+cur_frm.doc.delivery_note+\"|\"+cur_frm.doc.percentage_dp+\"|\"+cur_frm.doc.inquiry,\r\n\t});\r\n    }else if(frm.doc.type_of_invoice == \"Pelunasan\"){\r\n\terpnext.utils.map_current_doc({\r\n\t    method: \"preorder.preorder.lemparan.get_items_from_pelunasan\",\r\n\t    source_name: frm.doc.total_delivery_note+\"|\"+cur_frm.doc.percentage_dp+\"|\"+cur_frm.doc.inquiry,\r\n\t});\r\n    }\r\n})\r\n", 
  "script_type": "Client"
 }
]